(function(p){function l(){var f=this;f.storage={};f.lenght=0;return{setItem:function(e,g){f.storage[e]=g;this.length=f.lenght++;return!0},getItem:function(e){return f.storage[e]},get:function(e){for(var g in f.storage)if(0==e)return f.storage[g];return null},removeItem:function(e){this.length--;delete f.storage[e]},hasOwnProperty:function(e){return f.storage.hasOwnProperty(e)},clear:function(){f.storage={};f.lenght=0;this.length=f.lenght},length:0}}var q=window.md5||function(f){var e=0,g,h,b;if(0==
f.length)return e;g=0;for(b=f.length;g<b;g++)h=f.charCodeAt(g),e=(e<<5)-e+h,e|=0;return e},k=null;if("object"===typeof localStorage)try{var m=new Date+0,n="localStorageTest"+m;localStorage.setItem(n,m);localStorage.removeItem(n);k=localStorage}catch(f){k=new l}else k=new l;p.JSONStore=function(f){function e(a,d){b.cl.map(function(c){c.k===a&&c.cb(a,d);c.k||c.cb(a,d)})}function g(a,d){b.dl.map(function(c){c.k===a&&c.cb(a,d)})}var h={},b=this;b.prefix=f||"JSONStore-";b.prefixExp=new RegExp("^"+b.prefix+
"@.*$");b.storage=k;b.toHashKey=function(a){return b.prefix+"@"+q(JSON.stringify(a))};b.cl=[];b.dl=[];b.pub={on:function(a,d,c){if("change"==a)return b.cl.push({k:d,cb:c});if("delete"==a)return b.dl.push({k:d,cb:c})},set:function(a,d){d="undefined"===typeof d?null:d;var c=b.toHashKey(a);h[c]=d;b.storage.setItem(c,JSON.stringify(d));e(a,d);return d},exists:function(a){return b.toHashKey(a)in b.storage},get:function(a,d){var c=b.toHashKey(a);if(!(c in h))if(c in b.storage&&b.storage.hasOwnProperty(c)){var e=
JSON.parse(b.storage[c]);h[c]=e}else h[c]=d;return h[c]},append:function(a,d){var c=this.get(a,[]);return c instanceof Array?(c.push(d),this.set(a,c),e(a,c),c):!1},appendUnique:function(a,d){return this.some(a,d)?(e(a,d),this.get(a,d)):this.append(a,d)},popItems:function(a,d){var c=[],b=[];this.get(a,[]).map(function(a){a!=d?c.push(a):b.push(a)});this.set(a,c);return b},pop:function(a){var d=this.get(a);this.remove(a);return d},setValue:function(a,d,c){var b=this.get(a,{});if(b instanceof Array)return!1;
b[d]=c;this.set(a,b);return b},extendValue:function(a,d,c){var b=this.get(a,{});if(!(b instanceof Array)&&b instanceof Object){for(var e in c)d in b||(b[d]={}),b[d][e]=c[e];this.set(a,b);return b}},some:function(a,b){return this.get(a,[]).some(function(a,e,f){if(a==b)return!0})},popValue:function(a,b){var c=this.get(a,{});if(!(c instanceof Array)){var e=c[b];delete c[b];this.set(a,c);return e}},remove:function(a){var d=b.toHashKey(a);if(b.storage.hasOwnProperty(d)){var c=this.get(d);b.storage.removeItem(d);
g(a,c);return c}return!1},flush:function(){for(var a in b.storage)b.prefixExp.test(a)&&b.storage.removeItem(a);return!0}};return b.pub}})(this);