<!--
ARCHES - a program developed to inventory and manage immovable cultural heritage.
Copyright (C) 2013 J. Paul Getty Trust and World Monuments Fund

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
-->
{% extends "base-manager.htm" %}
{% load staticfiles %}
{% load i18n %}


{% block title %}
{{ block.super }}
{% trans "Mobile Survey Manager" %}
{% endblock title %}


{% block main_content %}
<div class="content-panel mobile-project-manager-editor">
    <div class="flex">

        <!-- Left Panel: Groups/Accounts -->
        <div class="left-column-container panel ep-card-tools-panel" style="flex: 0 0 270px;">

            <!-- Title Block -->
            <div class="title-block-title">
                <div class="layer-list">
                    <!-- Layer Filter -->
                    <div class="list-filter" data-bind="">
                        <div class="mpm-title-block">
                            <h4 class="title-block-title">{% trans 'Surveys' %}</h4>
                            <button id="" class="btn btn-lg btn-mint btn-active-dark btn-labeled ion-plus-round" data-bind="click: newMobileSurvey">{% trans "New Survey" %}</button>
                        </div>
                        <input type="text" class="form-control" style="width: 250px;" placeholder="{% trans 'Find a survey...' %}" data-bind="value: mobileSurveyFilter, valueUpdate: 'keyup'">

                        <!-- Clear Search -->
                        <span class="clear-node-search" data-bind="visible: mobileSurveyFilter().length > 0, click: function() { mobileSurveyFilter(''); }"><i class="fa fa-times-circle"></i></span>
                    </div>

                </div>
            </div>


            <!-- Survey Listing Panel-->
            <div id="user-grid" class="grid" style="display:none;" data-bind="visible: true">

                <!-- ko if: mobilesurveys().length ===  0 -->
                <div id="default-message-panel" class="left-column-message" style="">
                    {% trans "You haven't saved any surveys." %}
                    <p class="default-message">
                        {% trans "Use the form to set up a survey, then save your edits, and you're done!" %}
                    </p>
                </div>
                <!-- /ko -->

                <!-- ko if: mobilesurveys().length >  0 -->
                <div id="project-listing-panel" class="library-card-entry library-card-wide selected" style="width: 270px;padding-left: 6px;">
                    <!-- ko foreach: filteredMobileSurveys() -->
                    <div class="library-card selected selected-card" data-bind="css: {'selected-card': $parent.selectedMobileSurvey()===$data, 'inactive': !active()}, click: function (p) { $parent.selectedMobileSurvey(null);$parent.selectedMobileSurvey(p); }" style="width: 270px;">
                        <div class="mpm-project-card">
                            <a class="mpm-project-name" data-bind="text: name() === '' ? '{% trans "Unnamed Survey" %}' : name()"></a>
                        </div>
                        <div class="mpm-project-status" data-bind="text: active() ? '{% trans "Active" %}' : '{% trans "Inactive" %}'"></div>
                        <a class="mpm-project-delete" data-bind="click: function(val){$parent.deleteMobileSurvey(val)}, clickBubble: false, css: {'disabled': active()}" href="" class="" aria-expanded="true">{% trans 'delete' %}</a>
                        <div class="mpm-project-subtitle" data-bind="text: createdbyName"></div>
                    </div>
                    <!-- /ko -->
                </div>
                <!-- /ko -->
            </div>
        </div>


        <div id="" class="card-form-preview-container library-container">
            <div class="">

                <!-- Header -->
                <div class="relative library-header" style="height: 55px;">

                    <!-- Add Project -->
                    <div class="library-panel-search-bar">
                        <!--ko if: selectedMobileSurvey()-->
                        <button id="" class="btn btn-lg btn-danger btn-active-dark btn-labeled ion-minus-round" data-bind="click: deleteSelectedMobileSurvey, attr: {disabled: selectedMobileSurvey().active() === true}">{% trans "Delete Survey" %}</button>
                        <!--/ko-->
                    </div>
                </div>

                <div id="" class="library-grid" style="display:none;" data-bind="visible: true">

                    <!-- ko if: selectedMobileSurvey() -->
                    <div id="sample-project" class="project-panel">

                        <!--Project heading-->
                        <div class="project-panel-header edit-mode">
                            <h3 class="project-panel-title" data-bind="text: selectedMobileSurvey().name() === '' ? '{% trans "Unnamed Survey" %}' : selectedMobileSurvey().name()"></h3>
                            <ul class="msm-edit-buttons">
                                <button class="btn btn-mint btn-labeled btn-active-dark fa fa-undo" data-bind="click: discardEdits, css: {'disabled': selectedMobileSurvey().dirty()==false}">{% trans 'Discard Edits' %}</button>
                                <button id="btn-save-edits" class="btn btn-primary btn-labeled btn-active-dark fa fa-check" data-bind="click: saveMobileSurvey, css: {'disabled': selectedMobileSurvey().dirty()==false}">{% trans 'Save Edits' %}</button>
                            </ul>

                            <div class="">
                                <div class="project-details">
                                    <div class="project-status" data-bind="css: selectedMobileSurvey().active() ? 'active' : 'inactive', text: selectedMobileSurvey().active() ? '{% trans "Active" %}' : '{% trans "Inactive" %}'"></div>
                                    <li class="project-metadata-item">
                                        <span data-bind="text: selectedMobileSurvey().startdate() || '?'"></span>
                                        {% trans 'to' %}
                                        <span data-bind="text: selectedMobileSurvey().enddate() || '?'"></span>
                                    </li>
                                </div>
                            </div>
                        </div>

                        <!--Project Details-->
                        <div id="project-details" class="project-panel-body" style="">

                            <div id="card-preview-crud" class="panel-body card-body fade in" style="padding: 0px; margin: 0px;">
                                <div id="cards" class="tab-base card-content-container outline" style="margin: 0px; margin-top: 0px;">

                                    <!--Nav Tabs-->
                                    <ul class="nav nav-tabs card-nav-container" style="">
                                        <li id="summary-group" class="active">
                                            <a id="summary-tab" data-toggle="tab" href="#summary-card" class="card-tab-title" aria-expanded="true">
                                                                {% trans 'Basic Settings' %}
                                                            </a>
                                        </li>
                                        <li id="card-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#location-card" class="card-tab-title" aria-expanded="false" data-bind="click: resizeMap">
                                                                {% trans 'Location' %}
                                                            </a>
                                        </li>
                                        <li id="icon-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#models-card" class="card-tab-title" aria-expanded="false">
                                                                {% trans 'Resources' %}
                                                            </a>
                                        </li>
                                        <li id="icon-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#data-card" class="card-tab-title" aria-expanded="false">
                                                                {% trans 'Data' %}
                                                            </a>
                                        </li>
                                        <li id="status-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#identities-card" class="card-tab-title" aria-expanded="false">
                                                                {% trans 'People' %}
                                                            </a>
                                        </li>
                                        <li id="activation-group" class="">
                                            <a id="project-summary-tab" data-toggle="tab" href="#project-summary-card" class="card-tab-title" aria-expanded="false">
                                                                {% trans 'Activate Survey' %}
                                                            </a>
                                        </li>
                                    </ul>

                                    <!--Tabs Content-->
                                    <div class="tab-content card-content-tab" style="margin-left: 0px;">

                                        <!-- Summary Card -->
                                        <div id="summary-card" class="mpm-card tab-pane fade active in" style="">
                                            <div class="mpm-card-content">
                                                <div class="panel-body card-panel-body project-card-body">
                                                    <div id="" class="card-content">

                                                        <!-- Project Info -->
                                                        <section id="" class="profile-list edit-mode">
                                                            <div class="account-wrapper">
                                                                <div class="row relative">


                                                                    <!-- Section Content -->
                                                                    <div class="col-sm-12">

                                                                        <div id="account-crud" class="" style="">
                                                                            <div class="row">
                                                                                <div class="col-sm-5">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label account-label">{% trans 'Survey name' %}</label>
                                                                                        <input type="text" class="form-control input-lg account-input" data-bind="value: selectedMobileSurvey().name, valueUpdate: 'keyup'">
                                                                                    </div>
                                                                                </div>

                                                                                <div class="col-sm-6">
                                                                                    <p class="account-tips">
                                                                                        {% trans 'Pick a concise name that makes it easy for people to find your survey' %}
                                                                                    </p>
                                                                                </div>
                                                                            </div>

                                                                            <hr style="border-color: #eee;">

                                                                            <div class="row">
                                                                                <div class="col-sm-5">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label account-label">{% trans 'Survey start date' %}</label>
                                                                                        <input class="form-control input-lg account-input" data-bind="datepicker: {format: dateFormat, minDate: false, maxDate: selectedMobileSurvey().enddate}, value: selectedMobileSurvey().startdate">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-sm-6">
                                                                                    <p class="account-tips">
                                                                                        {% trans 'The survey start and end dates are used to limit when people can add or edit Arches data.' %}
                                                                                    </p>
                                                                                </div>
                                                                            </div>

                                                                            <div class="row">
                                                                                <div class="col-sm-5">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label account-label">{% trans 'Survey end' %}</label>
                                                                                        <input class="form-control input-lg account-input" data-bind="datepicker: {format: dateFormat, minDate: selectedMobileSurvey().startdate, maxDate: false}, value: selectedMobileSurvey().enddate">
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <hr style="border-color: #eee;">

                                                                            <div class="row">
                                                                                <div class="col-sm-12">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label account-label">{% trans 'Description' %}</label>
                                                                                        <div>
                                                                                            <textarea class="form-control textarea textarea-resizable" rows="3" type="text" data-bind="value: selectedMobileSurvey().description, valueUpdate: 'keyup'"></textarea>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </section>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Map Card -->
                                        <div id="location-card" class="mpm-card tab-pane fade msm-location-card ">
                                            <div class="msm-map-container">
                                                <div class="col-sm-12 msm-basemap-location">
                                                    <div class="form-group" style="margin-bottom: 0px;">
                                                        <label class="control-label account-label">{% trans 'Basemap location (MBTiles file url)' %}</label>
                                                        <input type="text" class="form-control input-lg" data-bind="value: selectedMobileSurvey().tilecache, valueUpdate: 'keyup'">
                                                    </div>
                                                </div>

                                                <div>
                                                  <!-- ko component: {
                                                      name: 'map-widget',
                                                      params: {
                                                        type: 'survey-bounds',
                                                        configForm: false,
                                                        node: null,
                                                        value: selectedMobileSurvey().bounds,
                                                        state: 'form',
                                                        config: {
                                                            basemap: basemap.name,
                                                            bearing: 0,
                                                            centerX: defaultCenterX,
                                                            centerY: defaultCenterY,
                                                            featureColor: "rgba(55,32,196,0.85)",
                                                            featureEditingDisabled: false,
                                                            featureLineWidth: 2,
                                                            featurePointSize: 6,
                                                            geocodePlaceholder: "Locate a Place or Address",
                                                            geocodeProvider: geocoderDefault,
                                                            geocoderVisible: true,
                                                            geometryTypes: [{'id':'Polygon','text':'Polygon'}],
                                                            mapControlsHidden: false,
                                                            maxZoom: mapDefaultMaxZoom,
                                                            minZoom: mapDefaultMinZoom,
                                                            overlayConfigs: [],
                                                            overlayOpacity: 0,
                                                            pitch: 0,
                                                            zoom: mapDefaultZoom
                                                        }
                                                    }
                                                  } --><!-- /ko -->
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Models Card -->
                                        <div id="models-card" class="identities-list tab-pane fade">
                                            <div class="mpm-card-content">
                                                <div>
                                                    <div class="flex relative">

                                                        <div class="msm-resource-panel" style="" data-bind="with:resourceList">
                                                            {% include 'views/mobile-survey-manager/resource-list.htm' %}
                                                        </div>

                                                        <div class="msm-resource-cards" data-bind="style: {top: ((resourceList.selectedIndex() * 60 + 120) + (resourceList.selectedIndex() * 15.0)) + 'px' }, visible: resourceList.selected() && resourceList.hideResourceList() != true">

                                                            <div class="relative">

                                                                <p class="mpm-instructions">
                                                                    Drag &amp; drop the forms you want in your project from the list on the left to the "Selected forms" column.  <strong> Note that the order of the forms in the "Selected forms" column determines the order of display in the mobile app.</strong>
                                                                </p>

                                                                <!--ko if: resourceList.selected() -->
                                                                <!--ko if: resourceList.selected().cards().length > 0 -->
                                                                <div class="mpm-card-container">
                                                                    <div class="mpm-card-list available">
                                                                        <div class="mpm-selector-header relative">
                                                                            <input class="form-control input-lg mpm-form-finder" placeholder="{% trans 'find a form...' %}" type="text" data-bind="value: resourceList.cardFilter, valueUpdate: 'keyup'">

                                                                            <!-- select all switch -->
                                                                            <div class="mpm-selector-btns">
                                                                                <a class="" data-bind="click: function(val) {selectedMobileSurvey().addAllCardsByResource(val)}">{% trans 'Select all' %}</a>
                                                                            </div>
                                                                        </div>

                                                                        <div class="mpm-card-list-items">
                                                                            <div data-bind="sortable: {data:resourceList.selected().cards, afterMove: selectedMobileSurvey().updateUnapproved,  addToSelf: true}" class="ko_container ui-sortable">
                                                                                <div class="list-group-item get-user-detail" data-bind="click: function(){ $data.expanded(!$data.expanded()) }, visible: ($data.filtered() === false && $data.approved() === false)">
                                                                                    <div class="mpm-user-title mpm-user-name">
                                                                                        <h4 data-bind='text: $data.name'></h4>
                                                                                    </div>

                                                                                    <p class="mpm-user-subtitle resource">
                                                                                        <span>{% trans 'Fields:' %}</span><span class="mpm-widget-labels" data-bind="text: $data.widgetlabels"></span>
                                                                                    </p>

                                                                                    <div class="mpm-user-summary" data-bind="css: {'expanded': $data.expanded()}">
                                                                                        <!-- ko foreach: { data:$data.nodes, as: 'node'} -->
                                                                                        <!--ko if: node.datatype != 'semantic' -->
                                                                                        <div class="mpm-model-detail-panel">
                                                                                            <div class="mpm-node-name" data-bind="text:node.name"></div>
                                                                                            <ul class="mpm-node-detail-metadata">
                                                                                                <li class=""><span>{% trans 'Type: ' %}</span><span data-bind="text:node.datatype"></span></li>
                                                                                                <li class=""><span>{% trans 'Required: ' %}</span><span data-bind="text: node.isrequired ? 'Yes' : 'No'"></span></li>
                                                                                            </ul>
                                                                                        </div>
                                                                                        <!--/ko-->
                                                                                        <!--/ko-->
                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="mpm-card-list approved">
                                                                        <div class="mpm-selector-header relative">
                                                                            <div class="mpm-selector-header-txt">
                                                                                <strong>{% trans 'Selected forms' %}</strong>

                                                                                <!-- remove all switch -->
                                                                                <span class="mpm-select-switch-label">
                                                                                    <a class="pad-lft" data-bind="click: function(val) {selectedMobileSurvey().removeAllCardsByResource(val)}">{% trans 'Remove all' %}</a>
                                                                                </span>
                                                                            </div>
                                                                        </div>

                                                                        <div class="mpm-card-list-items">
                                                                            <div data-bind="sortable: {data: resourceList.selected().cards, afterMove: selectedMobileSurvey().updateApproved, addToSelf: true}" class="ko_container ui-sortable" style="min-height:100%">

                                                                                <div class="list-group-item get-user-detail" data-bind="click: function(){ $data.expanded(!$data.expanded()) }, visible: ($data.filtered() === false && $data.approved() === true)">
                                                                                    <div class="mpm-user-title mpm-user-name">
                                                                                        <h4 data-bind='text: $data.name'></h4>
                                                                                    </div>

                                                                                    <p class="mpm-user-subtitle resource">
                                                                                        <span>{% trans 'Fields:' %}</span>
                                                                                        <span class="mpm-widget-labels" data-bind="text: $data.widgetlabels"></span>
                                                                                    </p>

                                                                                    <div class="mpm-user-summary" data-bind="css: {'expanded': $data.expanded()}">
                                                                                        <!-- ko foreach: { data:$data.nodes, as: 'node'} -->
                                                                                        <!--ko if: node.datatype != 'semantic' -->
                                                                                        <div class="mpm-model-detail-panel">
                                                                                            <div class="mpm-node-name" data-bind="text:node.name"></div>
                                                                                            <ul class="mpm-node-detail-metadata">
                                                                                                <li class=""><span>{% trans 'Type: ' %}</span><span data-bind="text:node.datatype"></span></li>
                                                                                                <li class=""><span>{% trans 'Required: ' %}</span><span data-bind="text: node.isrequired ? 'Yes' : 'No'"></span></li>
                                                                                            </ul>
                                                                                        </div>
                                                                                        <!--/ko-->
                                                                                        <!--/ko-->
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!--/ko-->
                                                                <!--/ko-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End Models Card -->

                                        <!-- Data Card -->
                                        <div id="data-card" class="mpm-card tab-pane fade">
                                            <div class="mpm-card-content">
                                                <div class="panel-body card-panel-body project-card-body">
                                                    <div class="card-content">
                                                        <div class="mpm-activation-panel">
                                                            <div class="row pad-btm">
                                                                <!-- Activate Switch -->
                                                                <div class="col-sm-5 col-md-3">

                                                                    <div class="box-inline">
                                                                        <p class="mpm-item-listing-header data-panel" style="margin-bottom: 0px;">
                                                                            {% trans 'Allow users to download data' %}
                                                                        </p>

                                                                        <div class="toggle-container">
                                                                            <span class="switch switch-small" data-bind="css: {'on': selectedMobileSurvey().datadownloadconfig.download()}, click: function(){
                                                                                selectedMobileSurvey().datadownloadconfig.download(!selectedMobileSurvey().datadownloadconfig.download());
                                                                            }"><small></small></span>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- Help Message-->
                                                                <div class="col-sm-6 col-md-9">
                                                                    <p class="account-tips" style="margin-top: 20px;">
                                                                        {% trans 'Downloading data allows users to access and edit existing Arches information in the field' %}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <!-- ko if: selectedMobileSurvey().datadownloadconfig.download() -->
                                                            <div id="data-definition" class="mpm-summary-panel">

                                                                <!-- Download Selector -->
                                                                <div class="msm-download-selector" style="display: block;">
                                                                    <div id="standard-download" class="category-title" href="" data-bind="css: {active: selectedMobileSurvey().showCustomDataDownload() === false }, click: function(){ selectedMobileSurvey().showCustomDataDownload(false)}">{% trans 'Download Records' %}</div>
                                                                    <div id="custom-download" class="category-title" href="" data-bind="css: {active: selectedMobileSurvey().showCustomDataDownload() === true}, click: function(){ selectedMobileSurvey().showCustomDataDownload(true)}">{% trans 'Custom Download' %}</div>
                                                                </div>


                                                                <!-- Standard Download -->
                                                                <div id="standard-download-panel" class="msm-download-panel" data-bind="visible: selectedMobileSurvey().showCustomDataDownload() === false">
                                                                    <p class="text-muted">
                                                                        {% trans 'Allow users to download the' %} <strong> {% trans 'first' %} {{ resource_download_limit }} {% trans 'records in the project extent' %} </strong> {% trans "for the resource models you've associated with this project." %}
                                                                    </p>

                                                                    <div class="form-group pad-ver msm-data-selection">

                                                                        <!-- Inline Checkboxes -->
                                                                        <div class="checkbox">
                                                                            <!-- ko foreach: {data:resourceList.items, as: 'resource'} -->
                                                                            <label class="form-checkbox form-normal form-primary" data-bind="text: resource.name, css: {'form-text' : true, active: _.contains($parent.selectedMobileSurvey().datadownloadconfig.resources(), resource.id)}, click: function(r){$parent.selectedMobileSurvey().updateResourceDownloadList(r)}"><input type="checkbox"></label>
                                                                            <!-- /ko -->
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- Custom Query -->
                                                                <div id="custom-download-panel" class="msm-download-panel" data-bind="visible: selectedMobileSurvey().showCustomDataDownload() === true">
                                                                    <p class="text-muted">
                                                                        {% trans 'To define records for download' %} <strong> {% trans 'copy and paste the URL from Arches search page' %}</strong>
                                                                    </p>

                                                                    <div class="form-group">
                                                                        <input type="text" id="" class="form-control" placeholder="Search query URL" data-bind="textInput: selectedMobileSurvey().datadownloadconfig.custom">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- /ko -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End Data Card -->


                                        <!-- Summary Card -->
                                        <div id="project-summary-card" class="mpm-card tab-pane fade">
                                            <div class="panel-body card-panel-body" style="">
                                                <div id="" class="card-content" style="">

                                                    <!-- Project Summary Panel -->
                                                    <div class="mpm-activation-panel">
                                                        <!-- Activate Project -->
                                                        <div class="row pad-btm">
                                                            <!-- Activate Switch -->
                                                            <div class="col-sm-5 col-md-3">

                                                                <div class="box-inline">
                                                                    <p class="mpm-item-listing-header" style="margin-bottom: 0px;">{% trans 'Activate Survey' %}</p>

                                                                    <div class="toggle-container">
                                                                        <span class="switch switch-small" data-bind="css: {'on': selectedMobileSurvey().active()}, click: function(){
                                                                            selectedMobileSurvey().active(!selectedMobileSurvey().active());
                                                                        }"><small></small></span>
                                                                    </div>

                                                                </div>
                                                            </div>

                                                            <!-- Help Message-->
                                                            <div class="col-sm-6 col-md-9">
                                                                <p class="account-tips" style="margin-top: 20px;">
                                                                    By activating the survey you will send users an email with the information needed to begin data editing activitites.
                                                                </p>
                                                            </div>
                                                        </div>

                                                        <!-- Survey Summary -->
                                                        <div class="msm-settings-summary">

                                                            <!-- Survey Settings -->
                                                            <div class="mpm-summary-panel">
                                                                <p class="mpm-item-listing-header" style="margin-bottom: 0px;">
                                                                    {% trans 'Summary' %}
                                                                </p>
                                                                <ul class="mpm-node-detail-metadata">
                                                                    <li class="">
                                                                        Number of edits: 0
                                                                    </li>
                                                                    <li class="">
                                                                        Contributors: 0
                                                                    </li>
                                                                    <li class="">
                                                                        Offline Basemap: Streets-Grey
                                                                    </li>
                                                                </ul>
                                                            </div>

                                                            <!-- User Summary -->
                                                            <div class="mpm-summary-panel">
                                                                <p class="mpm-item-listing-header" style="margin-bottom: 0px;">
                                                                    {% trans 'Groups/Users' %}
                                                                </p>
                                                                <ul class="mpm-node-detail-metadata">
                                                                    <li class="">
                                                                        {% trans 'Groups' %} (<span data-bind="text: selectedMobileSurvey().approvedGroupNames().length"></span>)
                                                                        <ul class="mpm-node-detail-metadata">
                                                                            <li class="" data-bind="text:  selectedMobileSurvey().approvedGroupNames().join(', ')">
                                                                            </li>
                                                                        </ul>
                                                                    </li>
                                                                </ul>
                                                                <ul class="mpm-node-detail-metadata">
                                                                    <li class="">
                                                                        {% trans 'Users' %} (<span data-bind="text: selectedMobileSurvey().approvedUserNames().length"></span>)
                                                                        <ul class="mpm-node-detail-metadata">
                                                                            <li class="" data-bind="text: selectedMobileSurvey().approvedUserNames().join(', ')">

                                                                            </li>
                                                                        </ul>
                                                                    </li>
                                                                </ul>
                                                            </div>

                                                            <!-- Model/Card Summary -->
                                                            <div class="mpm-summary-panel">
                                                                <p class="mpm-item-listing-header" style="margin-bottom: 0px;">
                                                                    {% trans 'Models and Data Entry Cards' %}
                                                                </p>
                                                                <!--ko if: resourceList.hasCards() -->
                                                                <!--ko foreach: {data: resourceList.items, as: 'resource'} -->
                                                                <!--ko if: resource.added() === true -->
                                                                <ul class="mpm-node-detail-metadata">
                                                                    <li class="">
                                                                        <div data-bind="text: resource.name + ' (' + resource.cardcount() + ' data entry cards)'"></div>
                                                                        <!--ko foreach: {data: resource.cards, as: 'card'} -->
                                                                        <ul class="mpm-node-detail-metadata">
                                                                            <!--ko if: card.approved -->
                                                                            <li data-bind="text: card.name"></li>
                                                                            <!--/ko-->
                                                                        </ul>
                                                                        <!--/ko-->
                                                                    </li>
                                                                </ul>
                                                                <!--/ko-->
                                                                <!--/ko-->
                                                                <!--/ko-->
                                                                <!--ko ifnot: resourceList.hasCards() -->
                                                                <ul class="mpm-node-detail-metadata">
                                                                    <li class="">
                                                                        <div>{% trans 'No forms selected' %}</div>
                                                                    </li>
                                                                </ul>
                                                                <!--/ko-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End Summary Card -->


                                        <!-- Groups/Users Card -->
                                        <div id="identities-card" class="identities-list tab-pane fade">
                                            <div class="mpm-card-content">
                                                <div>
                                                    <div class="flex relative">

                                                        <div class="msm-resource-panel identities" style="" data-bind="with:identityList">
                                                            {% include 'views/mobile-survey-manager/identity-list.htm' %}
                                                        </div>

                                                        <!-- start identity content -->
                                                        <div class="msm-resource-cards identities" data-bind="style: {top: ((identityList.selectedIndex() * 60 + 120) + (identityList.selectedIndex() * 15.0)) + 'px' }, visible: identityList.selected()  && identityList.hideIdentityDetails() != true">

                                                            <div class="relative">

                                                                <div class="row">
                                                                    <div class="col-sm-6" style="" data-bind="">
                                                                        <div class="box-inline">

                                                                            <!-- ko if: identityList.selected().type === 'user' -->
                                                                            <div class="">
                                                                                <span class="switch switch-small mpm-account-switch" data-bind="css: {'on': selectedMobileSurvey().hasIdentity()}, click: function(){selectedMobileSurvey().toggleIdentity()}"><small></small>

                                                                                </span>
                                                                                <p class="mpm-account-switch-text" style="margin-bottom: 0px;">{% trans 'Add this user to survey' %}</p>
                                                                                        <div style="display:flex; flex-direction:row;">
                                                                                        <div class="arches-toggle-sm"></div>
                                                                                            <div style="margin-top: -17px;"></div>
                                                                                        </div>
                                                                                <span class="arches-toggle-subtitle"></span>
                                                                            </div>
                                                                            <!-- /ko -->

                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- Users in this Account -->
                                                                <div class="mpm-account-detail-panel">

                                                                    <!-- User Listing -->
                                                                    <div id="user-cards" class="list-group user-cards">
                                                                        <!-- Title/Filter/Pagination -->
                                                                        <!--ko if: identityList.selected().type === 'group' -->

                                                                        <div class="msm-user-summary">
                                                                            <div class='msm-group-users'>


                                                                                <div class="mpm-selector-header relative">

                                                                                    <!-- Panel Header -->
                                                                                    <div class="mpm-selector-header-txt">
                                                                                        <input class="form-control input-lg" style="    margin-top: -13px;width: 300px;" placeholder="{% trans 'find a user in this group...' %}"  type="text" data-bind="value: selectedMobileSurvey().userFilter, valueUpdate: 'keyup'">
                                                                                    </div>

                                                                                    <div class="mpm-selector-btns">
                                                                                        <a class="" href="">Select all</a>
                                                                                        <span class="switch switch-small" data-bind="css: {'on': selectedMobileSurvey().hasIdentity()}, click: function(){selectedMobileSurvey().toggleIdentity()}"><small></small></span>
                                                                                    </div>

                                                                                    <!-- Info panel -->
                                                                                    <div class="mpm-user-info-panel" style="padding: 0px;">

                                                                                        <!-- ko foreach: selectedMobileSurvey().filteredUsers() -->
                                                                                        <div href="#" class="list-group-item get-user-detail" data-bind="click: function(){ $data.expanded(!$data.expanded());  $parent.selectedMobileSurvey().selectedUser($data)}, css: {selected: $parent.selectedMobileSurvey().selectedUser() == $data}">

                                                                                            <div class="mpm-user-title mpm-user-name">

                                                                                                <h4 data-bind='text: $data.username'></h4>

                                                                                                <!--ko if: $data.groups-->
                                                                                                <div class='mpm-user-status pull-right' data-bind="css: {invited : _.contains($parent.selectedMobileSurvey().users(), $data.id)}">
                                                                                                    <span data-bind="text: _.contains($parent.selectedMobileSurvey().users(), $data.id) ? '{% trans 'Approved' %}': '{% trans 'Not Approved' %}'"></span>
                                                                                                </div>
                                                                                                <!--/ko-->
                                                                                            </div>

                                                                                            <div class="mpm-user-subtitle">
                                                                                                <p>{% trans 'Activity: 0 edits' %}</p>

                                                                                                <div>
                                                                                                    <span>{% trans 'Last Login:' %}</span>
                                                                                                    <span class="last-login" data-bind="text: $data.last_login"></span>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <!-- /ko -->






                                                                                    </div>
                                                                                </div>



                                                                            </div>

                                                                            <!-- ko if: selectedMobileSurvey().selectedUser() -->
                                                                            <div class="mpm-user-summary">
                                                                                <div class="mpm-model-detail-panel">

                                                                                    <!-- User Info -->
                                                                                    <div class="mpm-selector-header relative">

                                                                                        <!-- Panel Header -->
                                                                                        <div class="mpm-selector-header-txt">
                                                                                            <strong>{% trans 'User Summary' %}</strong>
                                                                                        </div>

                                                                                        <!-- Info panel -->
                                                                                        <div class="mpm-user-info-panel" style="margin-top: 8px;">

                                                                                            <div class="mpm-node-name">
                                                                                                User
                                                                                            </div>
                                                                                            <ul class="mpm-node-detail-metadata">
                                                                                                <li class="">
                                                                                                    <span>{% trans 'Name:' %}
                                                                                                        <span class="last-login" data-bind="text: selectedMobileSurvey().selectedUser().first_name"></span>
                                                                                                        <span class="last-login" data-bind="text: selectedMobileSurvey().selectedUser().last_name"></span>
                                                                                                    </span>
                                                                                                </li>
                                                                                                <li class="">
                                                                                                    {% trans 'Email:' %} <a href="" data-bind="text: selectedMobileSurvey().selectedUser().email"></a>
                                                                                                </li>
                                                                                                <li class="">
                                                                                                    {% trans 'Groups:' %}
                                                                                                    <span class="last-login" data-bind="text: selectedMobileSurvey().selectedUser().group_names"></span>
                                                                                                </li>
                                                                                            </ul>

                                                                                            <div class="mpm-node-name">
                                                                                                Contributions
                                                                                            </div>
                                                                                            <ul class="mpm-node-detail-metadata">
                                                                                                <li class="">
                                                                                                    Edits: 0
                                                                                                </li>
                                                                                                <li>
                                                                                                    Devices (1)
                                                                                                    <ul class="mpm-node-detail-metadata">
                                                                                                        <li class="">
                                                                                                            <span>Name: iPhone (last login:<span class="last-login" data-bind="text: selectedMobileSurvey().selectedUser().last_login"></span>)</span>
                                                                                                        </li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                            </ul>

                                                                                        </div>
                                                                                    </div>

                                                                                </div>



                                                                                <div class="mpm-model-detail-panel">

                                                                                </div>
                                                                            </div>
                                                                        <!-- /ko -->
                                                                        </div>

                                                                        <!--/ko-->
                                                                        <!--ko if: identityList.selected().type === 'user' -->
                                                                        <a href="#" class="get-user-detail">
                                                                            <div class="mpm-user-title mpm-user-name">
                                                                                <!--ko if: identityList.selected().approved() -->
                                                                                <div class='mpm-user-status invited user'>
                                                                                    <span>{% trans 'Approved' %}</span>
                                                                                </div>
                                                                                <!--/ko-->
                                                                                <!--ko ifnot: identityList.selected().approved() -->
                                                                                <div class='mpm-user-status user pull-right'>
                                                                                    <span>{% trans 'Not Approved' %}</span>
                                                                                </div>
                                                                                <!--/ko-->
                                                                            </div>

                                                                            <div class="mpm-user-subtitle user">
                                                                                <div class="mpm-user-summary">
                                                                                    <div class="mpm-model-detail-panel">
                                                                                        <div class="mpm-node-name">
                                                                                            {% trans 'User Information' %}
                                                                                        </div>
                                                                                        <ul class="mpm-node-detail-metadata">
                                                                                            <li class="">
                                                                                                <span>{% trans 'Name:' %}
                                                                                                    <span class="last-login" data-bind="text: identityList.selected().first_name"></span>
                                                                                                    <span class="last-login" data-bind="text: identityList.selected().last_name"></span>
                                                                                                </span>
                                                                                            </li>
                                                                                            <li class="">
                                                                                                {% trans 'Email:' %} <a href="" data-bind="text: identityList.selected().email"></a>
                                                                                            </li>
                                                                                            <li class="">
                                                                                                {% trans 'Groups:' %}
                                                                                                <span class="last-login" data-bind="text: identityList.selected().groups"></span>
                                                                                            </li>
                                                                                        </ul>
                                                                                    </div>

                                                                                    <div class="mpm-model-detail-panel">
                                                                                        <div class="mpm-node-name">
                                                                                            Contributions
                                                                                        </div>
                                                                                        <ul class="mpm-node-detail-metadata">
                                                                                            <li class="">
                                                                                                Edits: 0
                                                                                            </li>
                                                                                            <li>
                                                                                                Devices (1)
                                                                                                <ul class="mpm-node-detail-metadata">
                                                                                                    <li class="">
                                                                                                        <span>Name: iPhone (last login:<span class="last-login" data-bind="text: identityList.selected().last_login"></span>)</span>
                                                                                                    </li>
                                                                                                </ul>
                                                                                            </li>
                                                                                        </ul>
                                                                                    </div>

                                                                                    <div class="mpm-model-detail-panel">
                                                                                        <div class="mpm-node-name">
                                                                                            Security
                                                                                        </div>
                                                                                        <ul class="mpm-node-detail-metadata">
                                                                                            <li class="">
                                                                                                Remove survey data from from user's device on next login?
                                                                                            </li>
                                                                                            <li class="">
                                                                                                <!--Switchery : Unchecked-->
                                                                                                <!--===================================================-->
                                                                                                <input id="wipe-project" class="js-switch-small" type="checkbox" style="margin-top: 0px; display: none;" data-switchery="true"><span class="switchery switchery-small" style="box-shadow: rgb(223, 223, 223) 0px 0px 0px 0px inset; border-color: rgb(223, 223, 223); background-color: rgb(255, 255, 255); transition: border 0.4s, box-shadow 0.4s;"><small style="left: 0px; background-color: rgb(255, 255, 255); transition: left 0.2s;"></small></span>
                                                                                                <!--===================================================-->
                                                                                            </li>
                                                                                        </ul>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </a>

                                                                        <!--ko if: _.filter(identityList.usersGroups(), function(u){return u.approved()}).length > 0 -->
                                                                        <div class="mpm-user-groups">{% trans 'Belongs to the following approved groups:' %}
                                                                            <ul class="user-group-list">
                                                                                <!-- ko foreach: identityList.usersGroups() -->
                                                                                <!-- ko if: $data.approved -->
                                                                                <li>
                                                                                    <span class='mpm-user-subtitle' data-bind="text:$data.name"></span>
                                                                                </li>
                                                                                <!--/ko -->
                                                                                <!--/ko -->
                                                                            </ul>
                                                                        </div>
                                                                        <!--/ko-->
                                                                        <!--/ko-->

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- end identity content -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End Groups/Users Card -->

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->


                </div>
            </div>
        </div>
    </div>
</div>
{% endblock main_content %}

{% block tabs %}{% endblock tabs %}

{% block pre_require_js %}
{{block.super}}
    <script>
        {% autoescape off %}define('mobile-survey-manager-data', [], function() {
            return {
                mobilesurveys: {{mobile_surveys}},
                resources: {{resources}},
                identities: {{identities}}
            };
        });{% endautoescape %}
    </script>
{% endblock pre_require_js %}
