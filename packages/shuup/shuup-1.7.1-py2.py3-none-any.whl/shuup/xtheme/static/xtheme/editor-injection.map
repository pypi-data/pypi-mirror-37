{"version":3,"sources":["../lib/domready.js","../lib/qs.js","../lib/el.js","../lib/ajax.js","editor-injection.js"],"names":["fn","loaded","push","callbacks","events","document","readyState","listener","forEach","ev","removeEventListener","shift","addEventListener","stringify","obj","bits","key","hasOwnProperty","encodeURIComponent","sort","join","parse","queryString","kw","location","search","replace","split","bit","val","undefined","mutateObj","mutations","mutate","mutateURL","url","base","length","processAttrs","element","attrs","eventHash","eventName","processChildren","children","Array","isArray","child","createTextNode","appendChild","el","selector","tag","classes","createElement","cls","classList","add","ajax","options","noop","client","XMLHttpRequest","success","error","async","open","method","send","data","onreadystatechange","status","responseText","statusText","_sidebarDiv","_sidebarIframe","_sidebarToggler","getSidebarDiv","id","body","getSidebarToggler","setSidebarVisibility","gettext","getSidebarIframe","visible","sidebarDiv","sidebarToggler","toggle","openPlaceholderEditor","domElement","layoutIdentifier","dataset","xtLayoutIdentifier","layoutDataKey","xtLayoutDataKey","placeholderName","xtPlaceholderName","globalType","xtGlobalType","xtContentTypeId","defaultConfigElement","querySelector","defaultConfigJSON","innerHTML","urlParams","viewName","window","XthemeEditorConfig","themeIdentifier","src","editUrl","addSnippetInjectionMarkup","nav","button","injectSnipperUrl","li","insertBefore","firstChild","addEditToggleMarkup","hidden","name","value","type","editing","edit","commandUrl","csrfToken","href","handleMessage","event","origin","placeholder","reloadPlaceholder","oldPh","Date","text","newDoc","implementation","createHTMLDocument","newPh","addPhClickHandler","target","contains","preventDefault","stopPropagation"],"mappings":"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","file":"editor-injection.map","sourceRoot":"../../static_src/injection","sourcesContent":["/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nconst callbacks = [];\nconst events = [\"DOMContentLoaded\", \"load\"];\nvar loaded = (document.readyState === \"complete\");\n\nfunction listener() {\n    events.forEach((ev) => { document.removeEventListener(ev, listener); });\n    if (!loaded) {\n        loaded = true;\n        var fn;\n        while ((fn = callbacks.shift())) {\n            fn();\n        }\n    }\n}\n\nif (!loaded) {\n    events.forEach((ev) => { document.addEventListener(ev, listener); });\n}\n\nexport default function(fn) {\n    if (loaded) {\n        setTimeout(fn, 0);\n    } else {\n        callbacks.push(fn);\n    }\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nexport function stringify(obj) {\n    const bits = [];\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key) && obj[key]) {\n            bits.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(obj[key]));\n        }\n    }\n    return bits.sort().join(\"&\");\n}\n\nexport function parse(queryString) {\n    const kw = {};\n    if (queryString === null || queryString === undefined) {\n        queryString = location.search.replace(/^\\?/, \"\");\n    }\n    queryString.split(\"&\").forEach((bit) => {\n        const [key, val] = bit.split(\"=\", 2);\n        kw[key] = (val !== undefined ? val : true);\n    });\n    return kw;\n}\n\nexport function mutateObj(obj, mutations) {\n    for (var key in mutations) {\n        if (!mutations.hasOwnProperty(key)) {\n            continue;\n        }\n        const val = mutations[key];\n        if (val === null || val === undefined) {\n            delete obj[key];\n        } else {\n            obj[key] = val;\n        }\n    }\n    return obj;\n}\n\nexport function mutate(mutations, queryString) {\n    const kw = parse(queryString);\n    mutateObj(kw, mutations);\n    return stringify(kw);\n}\n\nexport function mutateURL(url, mutations) {\n    var [base, search] = url.split(\"?\", 2);\n    search = mutate(mutations, search || \"\");\n    return base + (search.length ? \"?\" + search : \"\");\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nfunction processAttrs(element, attrs) {\n    for (var key in attrs) {\n        if (!attrs.hasOwnProperty(key)) {\n            continue;\n        }\n        if (key === \"$events\") {\n            const eventHash = attrs[key];\n            for (var eventName in eventHash) {\n                if (!eventHash.hasOwnProperty(eventName)) {\n                    continue;\n                }\n                element.addEventListener(eventName, eventHash[eventName], false);\n            }\n            continue;\n        }\n        element[key] = attrs[key];\n    }\n}\n\nfunction processChildren(element, children) {\n    if (children && !Array.isArray(children)) {\n        children = [children];\n    }\n    (children || []).forEach((child) => {\n        if (!child) {\n            return;\n        }\n        if (typeof child === \"string\") {\n            child = document.createTextNode(child);\n        }\n        element.appendChild(child);\n    });\n}\n\n/**\n * Generate a HTML element.\n * For instance, el(\"div.foo\", {id: \"y\"}, [\"Hello\", \"Hello\"]) would generate\n * a div with the outerHTML `<div id=\"y\" class=\"foo\">HelloHello</div>`.\n *\n * @param selector Tag + CSS classes, separated with full-stops.\n * @param attrs Optional hash of attributes to assign on the new element.\n * @param children Optional array of children for the node.\n * @returns {HTMLElement}\n */\nexport default function el(selector, attrs, children) {\n    const [tag, ...classes] = selector.split(\".\");\n    const element = document.createElement(tag);\n    classes.forEach((cls) => {\n        element.classList.add(cls);\n    });\n    if (Array.isArray(attrs)) {\n        children = attrs;\n        attrs = {};\n    }\n    processAttrs(element, attrs);\n    processChildren(element, children);\n    return element;\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n/**\n * BASED ON:\n * xhr-ajax.js Copyright (C) 2013 Craig Roberts (http://craig0990.co.uk)\n *\n * Licensed under the MIT License (http://mit-license.org)\n */\n\nexport default function ajax(options) {\n    const noop = function() {};\n    const client = new XMLHttpRequest();\n    options.success = options.success || noop;\n    options.error = options.error || noop;\n    options.async = true;\n    client.open(options.method || \"GET\", options.url);\n    client.send(options.data);\n    client.onreadystatechange = function() {\n        if (this.readyState !== 4) {\n            return;\n        }\n        if (this.status === 200) {\n            options.success(this.responseText, this);\n        } else {\n            options.error(this.status, this.statusText, this);\n        }\n        client.onreadystatechange = noop;\n    };\n    return client;\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n// import styles\nimport \"./editor-injection.less\";\n\nimport domready from \"../lib/domready\";\nimport { stringify, mutateURL } from \"../lib/qs\";\nimport el from \"../lib/el\";\nimport ajax from \"../lib/ajax\";\n\nvar _sidebarDiv = null;\nvar _sidebarIframe = null;\nvar _sidebarToggler = null;\n\nfunction getSidebarDiv() {\n    if (_sidebarDiv === null) {\n        _sidebarDiv = el(\"div\", { id: \"xt-edit-sidebar\" }, [\n            el(\"div\", { id: \"xt-edit-sidebar-container\" },\n                (_sidebarIframe = el(\"iframe\", {\n                    id: \"xt-edit-sidebar-iframe\"\n                }))\n            )\n        ]);\n        document.body.appendChild(_sidebarDiv);\n    }\n    return _sidebarDiv;\n}\n\nfunction getSidebarToggler() {\n    if (_sidebarToggler === null) {\n        _sidebarToggler = el(\"div\", {\n            id: \"xt-sidebar-toggler\",\n            $events: {\n                click: () => {\n                    setSidebarVisibility();\n                }\n            }\n        }, [el(\"i.fa\"), gettext(\"Toggle Editor\")])\n        document.body.appendChild(_sidebarToggler);\n    }\n    return _sidebarToggler;\n}\n\nfunction getSidebarIframe() {\n    getSidebarDiv();\n    getSidebarToggler();\n    return _sidebarIframe;\n}\n\nfunction setSidebarVisibility(visible) {\n    const sidebarDiv = getSidebarDiv();\n    const sidebarToggler = getSidebarToggler();\n    if (visible === undefined) {\n        sidebarDiv.classList.toggle(\"visible\");\n        sidebarToggler.classList.toggle(\"visible\");\n    } else {\n        sidebarDiv.classList.toggle(\"visible\", !!visible);\n        sidebarToggler.classList.toggle(\"visible\", !!visible);\n    }\n}\n\nfunction openPlaceholderEditor(domElement) {\n    const layoutIdentifier = domElement.dataset.xtLayoutIdentifier;\n    const layoutDataKey = domElement.dataset.xtLayoutDataKey;\n    const placeholderName = domElement.dataset.xtPlaceholderName;\n    const globalType = domElement.dataset.xtGlobalType;\n    const contentTypeId = domElement.dataset.xtContentTypeId;\n    if (!placeholderName) {\n        return;\n    }\n    const defaultConfigElement = domElement.querySelector(\"script.xt-ph-default-layout\");\n    const defaultConfigJSON = (defaultConfigElement ? defaultConfigElement.innerHTML : null);\n    const viewName = window.XthemeEditorConfig.viewName;\n    const urlParams = {\n        view: viewName,\n        theme: window.XthemeEditorConfig.themeIdentifier,\n        ph: placeholderName,\n        \"global_type\": globalType,\n        \"layout_identifier\": layoutIdentifier,\n        \"layout_data_key\": layoutDataKey,\n        // TODO: Hopefully we won't get any problems with too-long query strings (2048 is the maximum for IE):\n        \"default_config\": defaultConfigJSON\n    };\n    getSidebarIframe().src = window.XthemeEditorConfig.editUrl + \"?\" + stringify(urlParams);\n    setTimeout(() => {\n        setSidebarVisibility(true);\n    }, 1); // Defer slide-out, because otherwise browsers coalesce the addClass (as it's done in the same JS \"tick\")\n}\n\nfunction addSnippetInjectionMarkup() {\n    const nav = document.querySelector(\".navbar-admin-tools .navbar-nav\");\n    if (!nav) return;  // No navigation no snippet in navigation either\n    if (!document.querySelector(\".xt-ph\")) {\n        // No placeholders in the DOM, so no need to show Inject button here.\n        return;\n    }\n    const button = el(\"button\", {\n        \"type\": \"button\"\n    }, gettext(\"Custom CSS/JS\"));\n    button.addEventListener(\"click\", () => {\n        window.open(window.XthemeEditorConfig.injectSnipperUrl, \"_blank\");\n    });\n    const li = el(\"li.xt-snippet-injection\", [button]);\n    nav.insertBefore(li, nav.firstChild);\n}\n\nfunction addEditToggleMarkup() {\n    const hidden = (name, value) => el(\"input\", { type: \"hidden\", name, value });\n    const editing = (window.XthemeEditorConfig.edit);\n    if (!document.querySelector(\".xt-ph\")) {\n        // No placeholders in the DOM, so no need to show an Edit button here.\n        return;\n    }\n    const li = el(\"li.xt-edit-toggle\", [\n        el(\"form\", {\n            \"action\": window.XthemeEditorConfig.commandUrl,\n            \"method\": \"POST\"\n        }, [\n                hidden(\"csrfmiddlewaretoken\", window.XthemeEditorConfig.csrfToken),\n                hidden(\"path\", location.href),\n                hidden(\"command\", (editing ? \"edit_off\" : \"edit_on\")),\n                el(\"button\", {\n                    \"type\": \"submit\"\n                }, (editing ? gettext(\"Exit Edit\") : gettext(\"Edit Page\")))\n            ])\n    ]);\n    let nav = document.querySelector(\".navbar-admin-tools .navbar-nav\");\n    if (!nav) return;  // No navigation no edit toggle in navigation either\n    nav.insertBefore(li, nav.firstChild);\n}\n\nfunction handleMessage(event) {\n    if (!window.XthemeEditorConfig.edit) {\n        return;  // Not editing, ignore messages\n    }\n    if (event.origin !== location.origin) {\n        return;  // Not our origin, can't be our message\n    }\n    const placeholder = event.data.reloadPlaceholder;\n    if (!placeholder) {\n        return; // Not our message\n    }\n    const oldPh = document.querySelector(\"#xt-ph-\" + placeholder);\n    if (!oldPh) {\n        return;   // Not sure where to put output anyway\n    }\n    ajax({\n        url: mutateURL(location.href, { \"_uncache_\": +new Date() }),\n        success: (text) => {\n            const newDoc = document.implementation.createHTMLDocument();\n            newDoc.body.innerHTML = text;\n            const newPh = newDoc.querySelector(\"#xt-ph-\" + placeholder);\n            if (newPh) {\n                oldPh.innerHTML = newPh.innerHTML;\n            }\n        }\n    });\n}\n\nfunction addPhClickHandler() {\n    document.addEventListener(\"click\", (event) => {\n        const classList = event.target.classList;\n        if (classList && classList.contains(\"xt-ph\")) {\n            openPlaceholderEditor(event.target);\n            event.preventDefault();\n            event.stopPropagation();\n            return false;\n        }\n    }, false);\n}\n\ndomready(() => {\n    window.addEventListener(\"message\", handleMessage, false);\n    addSnippetInjectionMarkup();\n    addEditToggleMarkup();\n    if (window.XthemeEditorConfig.edit) {\n        addPhClickHandler();\n    }\n});\n"]}