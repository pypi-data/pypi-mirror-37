{"version":3,"sources":["../lib/domready.js","../lib/qs.js","../lib/el.js","editor.js"],"names":["fn","loaded","push","callbacks","events","document","readyState","listener","forEach","ev","removeEventListener","shift","addEventListener","stringify","obj","bits","key","hasOwnProperty","encodeURIComponent","sort","join","parse","queryString","kw","location","search","replace","split","bit","val","undefined","mutateObj","mutations","mutate","mutateURL","url","base","length","processAttrs","element","attrs","eventHash","eventName","processChildren","children","Array","isArray","child","createTextNode","appendChild","el","selector","tag","classes","createElement","cls","classList","add","post","args","window","CSRF_TOKEN","csrfmiddlewaretoken","inputs","Object","keys","map","type","name","value","form","method","action","href","body","submit","updateModelChoiceWidgetURL","select","selectedObject","options","selectedIndex","dataset","adminUrl","widgetExtraDiv","getElementById","id","linkText","interpolate","gettext","text","innerHTML","outerHTML","changesMade","on","x","y","newQs","cellCount","cellLimit","command","confirm","getElementsByName","setAttribute","plugin","each","we","contents","$editable","Sortable","querySelector","evt","from_y","oldIndex","to_y","newIndex","els","getElementsByClassName","i","item","prototype","indexOf","call","parentNode","refreshPlaceholderInParent","placeholderName","parent","postMessage"],"mappings":"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","file":"editor.map","sourceRoot":"../../static_src/editor","sourcesContent":["/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nconst callbacks = [];\nconst events = [\"DOMContentLoaded\", \"load\"];\nvar loaded = (document.readyState === \"complete\");\n\nfunction listener() {\n    events.forEach((ev) => { document.removeEventListener(ev, listener); });\n    if (!loaded) {\n        loaded = true;\n        var fn;\n        while ((fn = callbacks.shift())) {\n            fn();\n        }\n    }\n}\n\nif (!loaded) {\n    events.forEach((ev) => { document.addEventListener(ev, listener); });\n}\n\nexport default function(fn) {\n    if (loaded) {\n        setTimeout(fn, 0);\n    } else {\n        callbacks.push(fn);\n    }\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nexport function stringify(obj) {\n    const bits = [];\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key) && obj[key]) {\n            bits.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(obj[key]));\n        }\n    }\n    return bits.sort().join(\"&\");\n}\n\nexport function parse(queryString) {\n    const kw = {};\n    if (queryString === null || queryString === undefined) {\n        queryString = location.search.replace(/^\\?/, \"\");\n    }\n    queryString.split(\"&\").forEach((bit) => {\n        const [key, val] = bit.split(\"=\", 2);\n        kw[key] = (val !== undefined ? val : true);\n    });\n    return kw;\n}\n\nexport function mutateObj(obj, mutations) {\n    for (var key in mutations) {\n        if (!mutations.hasOwnProperty(key)) {\n            continue;\n        }\n        const val = mutations[key];\n        if (val === null || val === undefined) {\n            delete obj[key];\n        } else {\n            obj[key] = val;\n        }\n    }\n    return obj;\n}\n\nexport function mutate(mutations, queryString) {\n    const kw = parse(queryString);\n    mutateObj(kw, mutations);\n    return stringify(kw);\n}\n\nexport function mutateURL(url, mutations) {\n    var [base, search] = url.split(\"?\", 2);\n    search = mutate(mutations, search || \"\");\n    return base + (search.length ? \"?\" + search : \"\");\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nfunction processAttrs(element, attrs) {\n    for (var key in attrs) {\n        if (!attrs.hasOwnProperty(key)) {\n            continue;\n        }\n        if (key === \"$events\") {\n            const eventHash = attrs[key];\n            for (var eventName in eventHash) {\n                if (!eventHash.hasOwnProperty(eventName)) {\n                    continue;\n                }\n                element.addEventListener(eventName, eventHash[eventName], false);\n            }\n            continue;\n        }\n        element[key] = attrs[key];\n    }\n}\n\nfunction processChildren(element, children) {\n    if (children && !Array.isArray(children)) {\n        children = [children];\n    }\n    (children || []).forEach((child) => {\n        if (!child) {\n            return;\n        }\n        if (typeof child === \"string\") {\n            child = document.createTextNode(child);\n        }\n        element.appendChild(child);\n    });\n}\n\n/**\n * Generate a HTML element.\n * For instance, el(\"div.foo\", {id: \"y\"}, [\"Hello\", \"Hello\"]) would generate\n * a div with the outerHTML `<div id=\"y\" class=\"foo\">HelloHello</div>`.\n *\n * @param selector Tag + CSS classes, separated with full-stops.\n * @param attrs Optional hash of attributes to assign on the new element.\n * @param children Optional array of children for the node.\n * @returns {HTMLElement}\n */\nexport default function el(selector, attrs, children) {\n    const [tag, ...classes] = selector.split(\".\");\n    const element = document.createElement(tag);\n    classes.forEach((cls) => {\n        element.classList.add(cls);\n    });\n    if (Array.isArray(attrs)) {\n        children = attrs;\n        attrs = {};\n    }\n    processAttrs(element, attrs);\n    processChildren(element, children);\n    return element;\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2018, Shuup Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport domready from \"../lib/domready\";\nimport { mutate } from \"../lib/qs\";\nimport el from \"../lib/el\";\n\nfunction post(args) {\n    if (window.CSRF_TOKEN) {\n        args.csrfmiddlewaretoken = window.CSRF_TOKEN;\n    }\n    const inputs = Object.keys(args).\n        map((key) => {\n            const val = args[key];\n            return typeof val !== \"undefined\"? el(\"input\", {type: \"hidden\", name: key, value: val}) : null;\n        }\n    );\n    const form = el(\"form\", {method: \"POST\", action: location.href}, inputs);\n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction updateModelChoiceWidgetURL(select) {\n    const selectedObject = select.options[select.selectedIndex];\n    const url = selectedObject.dataset.adminUrl;\n    const widgetExtraDiv = document.getElementById(\"extra_for_\" + select.id);\n    const linkText = interpolate(gettext(\"Edit %s\"), [selectedObject.text]);\n    widgetExtraDiv.innerHTML = url ? el(\"a\", {\"target\": \"_blank\", \"href\": url}, [linkText]).outerHTML : \"\";\n}\n\ndomready(() => {\n    let changesMade = false;\n    $(\".layout-cell\").on(\"click\", function() {\n        const {x, y} = this.dataset;\n        const newQs = mutate({x, y});\n        location.href = \"?\" + newQs;\n    });\n    $(\".layout-add-cell-btn\").on(\"click\", function() {\n        const {y, cellCount, cellLimit} = this.dataset;\n        if (cellCount >= cellLimit) {\n            alert(interpolate(gettext(\"Error: Cannot add more than %s cells to one row.\"), [cellLimit]));\n            return;\n        }\n        post({y: y, command: \"add_cell\"});\n    });\n    $(\".layout-add-row-btn\").on(\"click\", function() {\n        const {y} = this.dataset;\n        post({y, command: \"add_row\"});\n    });\n    $(\".layout-del-row-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to delete this row?\"))) {\n            return;\n        }\n        const {y} = this.dataset;\n        post({y, command: \"del_row\"});\n    });\n    $(\".del-cell-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to delete this cell?\"))) {\n            return;\n        }\n        const {x, y} = this.dataset;\n        post({x, y, command: \"del_cell\"});\n    });\n    $(\".publish-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to publish changes made to this view?\"))) {\n            return;\n        }\n        if (changesMade) {\n            if (confirm(gettext(\"You have changed the form. Do you want to save them before publishing?\"))) {\n                document.getElementsByName(\"publish\")[0].setAttribute(\"value\", \"1\");\n                document.getElementById(\"xt-editor-form\").submit();\n            } else {\n                post({command: \"publish\"});\n            }\n        } else {\n            post({command: \"publish\"});\n        }\n    });\n    $(\".revert-btn\").on(\"click\", function() {\n        if (!confirm(gettext(\"Are you sure you wish to revert all changes made since the last published version?\"))) {\n            return;\n        }\n        post({command: \"revert\"});\n    });\n    $(\"input, select, textarea\").on(\"change input\", function() {\n        if (this.id === \"id_general-plugin\") {\n            return;\n        }\n        changesMade = true;\n    });\n    $(\"#id_general-plugin\").on(\"change\", function() {\n        if (changesMade) {\n            if (!confirm(gettext(\"Changing plugins will cause other changes made on this form to be lost.\"))) {\n                return;\n            }\n        }\n        post({command: \"change_plugin\", plugin: this.value});\n    });\n    $(\".xtheme-model-choice-widget\").each(function(element) {\n        updateModelChoiceWidgetURL(element);\n        element.addEventListener(\"change\", function() {\n            updateModelChoiceWidgetURL(document.getElementById(this.id));\n        });\n    });\n\n    // when summernote changes, set the flag on\n    jQuery(\".summernote-editor\").on(\"summernote.change\", (we, contents, $editable) => {\n        changesMade = true;\n    });\n\n    new Sortable(document.querySelector(\".layout-rows\"), {\n        handle: \".layout-move-row-btn\",\n\t\tforceFallback: true,\n        onUpdate: function(evt) {\n            post({command: \"move_row_to_index\", from_y: evt.oldIndex, to_y: evt.newIndex});\n        }\n    });\n\n    var els = document.getElementsByClassName(\"layout-row-cells\");\n    for(var i = 0; i < els.length; i++) {\n        new Sortable(els[i], {\n            group: 'cells',\n            onUpdate: function(evt) {\n                // cell re-arranged within the same row\n                post({\n                    command: \"move_cell_to_position\",\n                    from_x: evt.item.dataset.x,\n                    from_y: evt.item.dataset.y,\n                    to_x: evt.newIndex,\n                    to_y: evt.item.dataset.y\n                });\n            },\n            onAdd: function(evt) {\n                // cell moved to different row\n                post({\n                    command: \"move_cell_to_position\",\n                    from_x: evt.item.dataset.x,\n                    from_y: evt.item.dataset.y,\n                    to_x: Array.prototype.indexOf.call(evt.item.parentNode.children, evt.item),\n                    to_y: evt.item.parentNode.parentNode.dataset.y\n                });\n            }\n        });\n    }\n});\n\nwindow.refreshPlaceholderInParent = (placeholderName) => {\n    window.parent.postMessage({\"reloadPlaceholder\": placeholderName}, \"*\");\n};\n"]}